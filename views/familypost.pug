extends homepage.pug

block css
    style
        include ../public/stylesheets/homepage.css
        include ../public/stylesheets/family.css

block content
    .container-fluid.fill-height.fade-in
        .row

            .col-xs-12.col-sm-12
                .row


                    .col
                    .col-xs-12.col-sm-12.col-md-8.col-lg-8.col-xl-8

                        if(session)
                            h2.text-center #{group.title}
                    .col.text-right




        .row

            .col-xs-12.col-sm-12.col-md-4.col-lg-3.col-xl-3
                nav-collapse.fixed-left.dropdown-menu-left
                    .vertical-menu.mr-4

                        br
                        .row
                            .col-2
                                i.material-icons keyboard_arrow_left
                            .col-10
                                a.tabstyle(href='/home') Back

                        hr.my-4

                        .row
                            .col
                                a.tabstyle(href = `/view/${group._id}/info/`) About
                        br
                        .row
                            .col
                                a.active(href=`/view/${group._id}/post/` style = "font-weight: bolder; text-decoration: none;") Posts
                        br
                        .row
                            .col
                                a.active(href=`/view/${group._id}`) Artifacts

                        br
                        .row
                            .col
                                a.tabstyle(href = `/view/${group._id}/members`) Add Members
                        br
                        .row
                            .col
                                if (user._id.equals(group.owner))
                                    a.tabstyle(href='/home' data-toggle='modal' data-target='#modalFamilyForm',style="color:#666666;") Edit
                                    #modalFamilyForm.modal.fade(tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true')
                                        .modal-dialog(role='document')
                                            form(method='POST' action=`/view/${group._id}`, enctype = "multipart/form-data")
                                                .modal-content
                                                    .modal-header.text-center
                                                        h4.modal-title.w-100.font-weight-bold Update #{group.title}
                                                        button.close(type='button' data-dismiss='modal' aria-label='Close')
                                                            span(aria-hidden='true') &times;
                                                    .modal-body.mx-3
                                                        .md-form
                                                            label.font-weight-bold(for='title') Title
                                                            input#title.form-control(type='text', placeholder='Title*' name='title', value = group.title)
                                                            br
                                                        .md-form
                                                            label.font-weight-bold(for='desc') Description
                                                            .input-group
                                                                textarea#desc.form-control(type='text', placeholder=group.description, name='description',value = group.description)
                                                            br
                                                            label.font-weight-bold(for='owner') Admin:
                                                            select#owner(type='text', placeholder= group.owner name='owner', value = group.owner)
                                                                for member in members
                                                                    option(value=`${member._id}`) #{member.fname}
                                                            br
                                                        .md-form.text-center
                                                            label.font-weight-bold(for='preview') Upload Image (Optional)
                                                            .row
                                                                .col
                                                                .col-8.justify-content-center
                                                                    img.text-center#preview(src=group.photo)

                                                                .col
                                                            br
                                                            .row
                                                                .col
                                                                .col-8.justify-content-center.text-left
                                                                    input.custom-file-input#customFile(type='file' onchange='previewFile()' name = 'image' accept="image/*" style="width:50%;")
                                                                    label.custom-file-label(for='customFile') Choose file
                                                                .col


                                                    .modal-footer.justify-content-center
                                                        a(href = `/deletegroup/${group._id}`)
                                                            button.btn-danger.btn-sm(type="button" onclick="return confirm('Are you sure? This action cannot be undone and will delete all artifacts from this group.')") Delete Group
                                                        button.btn.btn-outline-secondary(type='submit') Update
                                else
                                    a.tabstyle(href = `/leaveGroup`) Leave group
                        hr.my-4

            .col-xs-12.col-sm-12.col-md-8.col-lg-9.col-xl-9.cardzone
                .row
                    .col-xs-12.col-sm-12.col-md-12.col-lg-12.col-xl-12
                        ul#myTab.nav.nav-tabs(role='tablist')
                            li.nav-item
                                a#status-tab.nav-link.active(data-toggle='tab', href='#status', role='tab', aria-controls='home', aria-selected='true') Status
                            li.nav-item
                                a#picture-tab.nav-link(data-toggle='tab', href='#picture', role='tab', aria-controls='profile', aria-selected='false') Pictures
                        #myTabContent.tab-content(style="background-color: white;")
                            #status.tab-pane.fade.show.active.m-3(role='tabpanel', aria-labelledby='status-tab')
                                |
                                br


                                .panel.panel-info(style="margin: 3px black;")
                                    form(method = "POST" action = "/poststatus", enctype = "multipart/form-data")
                                        .row
                                            .col
                                                .panel-heading.font-weight-bold
                                                    | Update Your Family

                                                .panel-body
                                                    form(method = "POST" action = "/post")
                                                        br

                                                        textarea.form-control#textsend(placeholder='Create a Post...', rows='3', name = 'post')
                                                        br
                                                        button.btn.btn-outline-info.pull-right#Button(type='submit' value = 'Submit' onkeyup="success()") Post




                            #picture.tab-pane.fade.m-3(role='tabpanel', aria-labelledby='picture-tab', style="background-color: white;")
                                |
                                |
                                br


                                .panel.panel-info(style="margin: 3px black;")
                                    form(method = "POST" action = "/poststatus", enctype = "multipart/form-data")
                                        .row
                                            .col
                                                .panel-heading.font-weight-bold
                                                    | Update Your Family


                                                    br
                                                    .row
                                                        .col
                                                            br

                                                            textarea.form-control#textsend(placeholder='Create a Post...', rows='3', name = 'post')

                                                        br
                                                        .col-3.text-right
                                                            img.text-right#previewpost(src=file, style="height:20px; width: 20px;")

                                                br


                                        .row


                                            .col.text-left.ml-3.mr-3
                                                input.custom-file-input#customFile(type='file' onchange='previewFile()' name = 'image' accept="image/*" style="width:50%;" multiple)
                                                label.custom-file-label(for='customFile')
                                                    | Upload Image (Optional)
                                        .row


                                            .col.text-right
                                                br
                                                a(href="/poststatus")
                                                    button.btn.btn-outline-info#Button(type='submit' value = 'Submit' onkeyup='success()') Post


                            hr.my-4

                            ul.media-list

                            each post in posts

                                each poster in posters
                                    if (post.owner == poster._id.toString())

                                        li.media
                                            .col-xs-12.col-sm-1.col-md-1.col-1
                                                if(poster.photo)
                                                    a.pull-left(href='/profile/:id')
                                                        img.img-circle(src=poster.photo, style="width: 3rem; height: 3rem;")
                                                else
                                                    a.pull-left
                                                        img.img-circle(src="https://icon-library.net/images/no-profile-picture-icon/no-profile-picture-icon-13.jpg", style="width: 3rem; height: 3rem;")

                                            .col
                                                .row
                                                    .col
                                                        a(href=`/profile/#{user._id}`)
                                                            strong.text-info #{poster.name}
                                                    .col-8.text-right
                                                        small.text-muted #{post.created}
                                                            if (user._id == post.owner || user._id == group.owner)
                                                                a(href = `/deletepost/${post._id}`)
                                                                    button.btn.btn-sm.btn-outline-secondary(onclick="return confirm('Are you sure? This action cannot be undone')" onchange="success()")
                                                                        i.fa.fa-trash
                                                .row
                                                    .col
                                                        p
                                                            | #{post.content}

                                                        br
                                                        if (post.photo)
                                                            img(src=post.photo, style="height: 15rem; width: 15rem;")
                                                        else
                                                            br


                                        hr.my-4

    // upload image for create group
    script.
        function previewFile() {
            var preview = document.querySelector('img');
            var file = document.querySelector('input[type=file]').files[0];
            var reader = new FileReader();

            reader.addEventListener("load", function (e) {
                //document.getElementById("b64").innerHTML = e.target.result;
                preview.src = reader.result.toString();
                document.getElementById('b64').value = e.target.result;
            }, false);

            if (file) {
                reader.readAsDataURL(file);
            }
        }

        .window.onload = function () {
            var fileUpload = document.getElementById("customFile");
            fileUpload.onchange = function () {
                if (typeof (FileReader) != "undefined") {
                    var dvPreview = document.getElementById("dvPreview");
                    dvPreview.innerHTML = "";
                    var regex = /^([a-zA-Z0-9\\s_\\.\-:])+(.jpg|.jpeg|.gif|.png|.bmp)$/;
                    for (var i = 0; i < fileUpload.files.length; i++) {
                        var file = fileUpload.files[i];
                        if (regex.test(file.name.toLowerCase())) {
                            var reader = new FileReader();
                            reader.onload = function (e) {
                                var img = document.createElement("IMG");
                                img.height = "100";
                                img.width = "100";
                                img.src = e.target.result;
                                dvPreview.appendChild(img);
                            }
                            reader.readAsDataURL(file);
                        } else {
                            alert(file.name + " is not a valid image file.");
                            dvPreview.innerHTML = "";
                            return false;
                        }
                    }
                } else {
                    alert("This browser does not support HTML5 FileReader.");
                }
            }
        }

        function success() {
            if (document.getElementById("textsend").input === "") {
                document.getElementById("Button").disabled = true;

            } else {
                document.getElementById('Button').disabled = false;
            }
        }










